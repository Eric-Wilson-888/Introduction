<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Five-Level Challenge Game</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        :root {
            --table-color: #204928;
            --card-w: 45px;
            --card-h: 68px;
            --accent: #f1c40f;
            --danger: #c0392b;
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: radial-gradient(circle at top, #222 0%, #050505 60%, #000 100%);
            color: white;
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
            user-select: none;
        }

        /* Top bar */
        #top-bar {
            height: 50px;
            background: linear-gradient(90deg, #111, #333);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.6);
            z-index: 100;
            flex-shrink: 0;
        }

        #top-bar .game-title {
            font-weight: bold;
            letter-spacing: 1px;
        }

        #current-level-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        #levels-container {
            flex: 1;
            position: relative;
        }

        .level-screen {
            position: absolute;
            inset: 0;
            display: none;
            width: 100%;
            height: calc(100vh - 50px);
            box-sizing: border-box;
        }

        /* LEVEL 1 */
        #level1 {
            display: flex;
            flex-direction: column;
        }

        #game-table {
            flex-grow: 1;
            background: radial-gradient(circle at center, #2d6b35 0%, #1b381d 100%);
            position: relative;
            box-shadow: inset 0 0 50px #000;
        }

        .player {
            position: absolute;
            width: 240px;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 10;
        }

        .player.active-turn .info-box {
            box-shadow: 0 0 15px var(--accent);
            border-color: var(--accent);
            transform: scale(1.05);
            background: rgba(50, 50, 50, 0.9);
        }

        .player.folded {
            opacity: 0.5;
            filter: grayscale(1);
        }

        #player {
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
        }

        #bot1 {
            top: 50%;
            left: 20px;
            transform: translateY(-50%);
        }

        #bot2 {
            top: 20px;
            left: 15%;
        }

        #bot3 {
            top: 20px;
            right: 15%;
        }

        #bot4 {
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
        }

        .info-box {
            background: rgba(0, 0, 0, 0.7);
            padding: 4px 12px;
            border-radius: 15px;
            border: 2px solid #444;
            text-align: center;
            min-width: 100px;
            margin-bottom: 5px;
            transition: all 0.3s;
            position: relative;
        }

        .p-name {
            font-size: 0.75em;
            color: #aaa;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .p-chips {
            color: #2ecc71;
            font-weight: bold;
            font-size: 1em;
        }

        .p-status {
            color: var(--accent);
            font-size: 0.75em;
            height: 1.1em;
            font-weight: bold;
        }

        .turn-marker {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--accent);
            color: #000;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            font-size: 11px;
            line-height: 18px;
            font-weight: bold;
            display: none;
            box-shadow: 0 0 5px white;
        }

        .active-turn .turn-marker {
            display: block;
        }

        .hand {
            display: flex;
            gap: 4px;
            height: var(--card-h);
            perspective: 800px;
        }

        .card {
            width: var(--card-w);
            height: var(--card-h);
            background: linear-gradient(135deg, #fafafa, #e1e1e1);
            border-radius: 6px;
            border: 1px solid #999;
            position: relative;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 18px;
            transition: transform 0.2s;
        }

        .card.red {
            color: #e74c3c;
        }

        .card.black {
            color: #2c3e50;
        }

        .card-back {
            background: repeating-linear-gradient(45deg, #2c3e50, #2c3e50 5px, #34495e 5px, #34495e 10px);
            border: 2px solid #fff;
        }

        .card-rank {
            position: absolute;
            top: 2px;
            left: 4px;
            font-size: 10px;
        }

        .card-suit {
            font-size: 24px;
        }

        .card-corner-br {
            position: absolute;
            bottom: 2px;
            right: 4px;
            font-size: 10px;
            text-align: right;
            line-height: 10px;
        }

        .pot-container {
            position: absolute;
            top: 55%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 5;
        }

        .pot-label {
            background: rgba(0, 0, 0, 0.6);
            padding: 5px 25px;
            border-radius: 20px;
            border: 1px solid #ffd700;
            color: #ffd700;
            font-weight: bold;
            font-size: 1.3em;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }

        .round-info {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.85em;
            margin-top: 6px;
            text-shadow: 0 1px 2px black;
        }

        #controls {
            height: 85px;
            background: #111;
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 10px;
            border-top: 1px solid #333;
            align-items: center;
            z-index: 20;
        }

        button {
            height: 55px;
            min-width: 80px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 0.9em;
            cursor: pointer;
            text-transform: uppercase;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: transform 0.1s, box-shadow 0.1s;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.5);
        }

        button:active {
            transform: scale(0.96);
        }

        button:disabled {
            background: #333 !important;
            color: #555 !important;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .btn-fold {
            background: var(--danger);
        }

        .btn-check {
            background: #27ae60;
        }

        .btn-raise {
            background: #d35400;
        }

        .btn-show {
            background: #8e44ad;
        }

        .sub-txt {
            font-size: 0.7em;
            font-weight: normal;
            margin-top: 2px;
            opacity: 0.9;
        }

        #msg-toast {
            position: fixed;
            top: 30%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.85);
            color: #fff;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.4em;
            font-weight: bold;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            border: 2px solid var(--accent);
            z-index: 1000;
            text-align: center;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.8);
        }

        @media (max-width: 600px) {
            .player {
                width: 90px;
            }

            :root {
                --card-w: 30px;
                --card-h: 46px;
            }

            .info-box {
                min-width: 80px;
                padding: 2px 5px;
            }

            .p-name {
                font-size: 0.6em;
                display: none;
            }

            .card-suit {
                font-size: 16px;
            }

            .card-rank {
                font-size: 8px;
            }

            .card-corner-br {
                display: none;
            }

            #bot1 {
                left: 5px;
            }

            #bot4 {
                right: 5px;
            }

            #bot2 {
                left: 10px;
                top: 10px;
            }

            #bot3 {
                right: 10px;
                top: 10px;
            }

            #player {
                bottom: 95px;
                width: 100%;
                display: flex;
                align-items: center;
            }

            #player .hand {
                margin-bottom: 5px;
            }

            .pot-container {
                top: 45%;
            }
        }

        /* LEVEL 2: SNAKE */

        #level2 {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 16px;
            box-sizing: border-box;
        }

        #snake-title {
            margin-bottom: 8px;
            font-size: 1.2rem;
            font-weight: bold;
        }

        #snake-info {
            font-size: 0.9rem;
            margin-bottom: 12px;
            opacity: 0.9;
            text-align: center;
        }

        #snakeCanvas {
            border-radius: 12px;
            border: 2px solid #444;
            box-shadow: 0 0 18px rgba(0, 0, 0, 0.9);
            background: radial-gradient(circle at top, #001220 0%, #000611 40%, #000 100%);
            max-width: 100%;
        }

        #snake-hud {
            display: flex;
            gap: 20px;
            margin-top: 10px;
            align-items: center;
            font-size: 0.9rem;
        }

        #snake-hud span.value {
            color: #2ecc71;
            font-weight: bold;
        }

        #snakeRestartBtn {
            margin-top: 12px;
            background: #2980b9;
        }

        #snake-message {
            margin-top: 8px;
            font-size: 0.9rem;
            opacity: 0.9;
            text-align: center;
        }

        /* LEVEL 3: NEW PvZ STYLE */

        #level3 {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 14px;
            box-sizing: border-box;
            overflow: hidden;
        }

        #pvz-header {
            text-align: center;
            margin-bottom: 8px;
        }

        #pvz-header h2 {
            margin: 4px 0;
        }

        #pvz-header p {
            margin: 2px 0;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        #pvz-hud {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        #pvz-hud span.value {
            color: #f1c40f;
            font-weight: bold;
        }

        #pvz-board {
            flex: 1;
            max-width: 980px;
            width: 100%;
            margin: 0 auto;
            background: radial-gradient(circle at top, #0f4d1a 0%, #05210b 40%, #020b06 100%);
            border-radius: 20px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.8);
            padding: 14px;
            display: flex;
            gap: 14px;
            box-sizing: border-box;
        }

        #pvz-grid-wrapper {
            flex: 3;
            display: flex;
            align-items: stretch;
            justify-content: center;
        }

        #pvz-grid {
            width: 100%;
            max-width: 720px;
            aspect-ratio: 9 / 5;
            display: grid;
            grid-template-rows: repeat(5, 1fr);
            grid-template-columns: repeat(9, 1fr);
            gap: 4px;
            padding: 8px;
            border-radius: 16px;
            box-sizing: border-box;
            background:
                repeating-linear-gradient(
                        0deg,
                        rgba(255, 255, 255, 0.06),
                        rgba(255, 255, 255, 0.06) 4px,
                        transparent 4px,
                        transparent 12px
                ),
                linear-gradient(135deg, #1c7b2d, #0c3b14);
            box-shadow: inset 0 0 18px rgba(0, 0, 0, 0.7);
        }

        .pvz-cell {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            background: radial-gradient(circle at top left, #45b649 0%, #1d6b27 55%, #13441a 100%);
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.6);
            cursor: pointer;
            transition: transform 0.08s, box-shadow 0.08s, background 0.2s;
        }

        .pvz-cell:nth-child(2n) {
            background: radial-gradient(circle at bottom right, #3da542 0%, #185a21 55%, #103817 100%);
        }

        .pvz-cell:hover {
            transform: translateY(-1px);
            box-shadow: 0 0 12px rgba(0, 0, 0, 0.8);
        }

        .pvz-cell.home-lane {
            background: linear-gradient(135deg, #4f2f0f, #281306);
            cursor: default;
        }

        .pvz-plant {
            position: absolute;
            inset: 12%;
            border-radius: 50%;
            background: radial-gradient(circle at top, #b4ffb4 0%, #43d35e 35%, #0c7a2c 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            box-shadow:
                    0 0 6px rgba(0, 0, 0, 0.7),
                    0 0 12px rgba(46, 204, 113, 0.8);
            animation: plant-bob 1.2s ease-in-out infinite alternate;
        }

        .pvz-plant::after {
            content: "ðŸŒ±";
        }

        .pvz-zombie {
            position: absolute;
            inset: 10%;
            border-radius: 14px;
            background: linear-gradient(135deg, #95a5a6, #34495e);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.9);
            animation: zombie-wobble 0.9s ease-in-out infinite alternate;
        }

        .pvz-zombie::after {
            content: "ðŸ§Ÿ";
        }

        .pvz-mower {
            position: absolute;
            left: 8%;
            top: 20%;
            width: 70%;
            height: 60%;
            border-radius: 12px;
            background: linear-gradient(145deg, #e74c3c, #8e1b10);
            box-shadow:
                    0 0 8px rgba(0, 0, 0, 0.8),
                    0 0 12px rgba(231, 76, 60, 0.9);
            animation: mower-idle 1.2s ease-in-out infinite alternate;
        }

        .pvz-mower::before {
            content: "";
            position: absolute;
            bottom: -18%;
            left: 10%;
            right: 10%;
            height: 28%;
            border-radius: 999px;
            background: #111;
            box-shadow: 0 0 4px rgba(0, 0, 0, 0.9);
        }

        .pvz-mower.used {
            filter: grayscale(1);
            opacity: 0.45;
            box-shadow: none;
            animation: none;
        }

        #pvz-side-panel {
            flex: 1.2;
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 10px 10px 10px 4px;
            box-sizing: border-box;
        }

        #pvz-message {
            min-height: 46px;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        #pvz-start-btn {
            background: #27ae60;
        }

        #pvz-help {
            font-size: 0.78rem;
            opacity: 0.85;
        }

        @keyframes plant-bob {
            from {
                transform: translateY(1px) scale(1.0);
            }
            to {
                transform: translateY(-2px) scale(1.02);
            }
        }

        @keyframes zombie-wobble {
            from {
                transform: translateY(0px) rotate(-2deg);
            }
            to {
                transform: translateY(-2px) rotate(2deg);
            }
        }

        @keyframes mower-idle {
            from {
                transform: translateX(0px);
            }
            to {
                transform: translateX(2px);
            }
        }

        @media (max-width: 900px) {
            #pvz-board {
                flex-direction: column;
                align-items: stretch;
            }

            #pvz-side-panel {
                padding-top: 0;
            }
        }

        @media (max-width: 600px) {
            #pvz-header p {
                font-size: 0.8rem;
            }

            #pvz-hud {
                gap: 10px;
                font-size: 0.8rem;
            }

            #pvz-board {
                padding: 10px;
            }

            #pvz-help {
                font-size: 0.75rem;
            }
        }

        /* LEVEL 4 & 5 QUIZZES */

        #level4,
        #level5 {
            display: block;
            overflow-y: auto;
            padding: 12px 16px 60px;
            box-sizing: border-box;
        }

        .quiz-wrapper {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.65);
            padding: 16px;
            border-radius: 12px;
            box-shadow: 0 0 18px rgba(0, 0, 0, 0.8);
        }

        .quiz-wrapper h2 {
            margin-top: 0;
        }

        .quiz-wrapper p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .quiz-question {
            margin-bottom: 10px;
            border-radius: 8px;
            border: 1px solid #333;
            padding: 6px 10px 8px;
        }

        .quiz-question legend {
            font-size: 0.9rem;
            padding: 0 2px;
        }

        .quiz-question label {
            display: block;
            font-size: 0.85rem;
            margin-top: 2px;
            cursor: pointer;
        }

        .quiz-submit-btn {
            margin-top: 12px;
            background: #2980b9;
        }

        .quiz-result {
            margin-top: 10px;
            font-size: 0.9rem;
        }

        /* ENDING SCENE */

        #ending {
            display: none;
            align-items: center;
            justify-content: center;
        }

        .final-scene {
            position: relative;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at bottom, #023 0%, #001 40%, #000 80%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            padding-bottom: 60px;
            box-sizing: border-box;
        }

        .tree {
            position: relative;
            width: 160px;
            height: 220px;
            margin-bottom: 30px;
        }

        .tree-star {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 32px;
            color: #f1c40f;
            text-shadow: 0 0 10px rgba(241, 196, 15, 0.9);
        }

        .tree-layer {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 50%;
            background: radial-gradient(circle at top, #2ecc71, #0b5b26);
            box-shadow: 0 0 15px rgba(46, 204, 113, 0.7);
        }

        .tree-layer.layer1 {
            width: 140px;
            height: 80px;
            bottom: 60px;
        }

        .tree-layer.layer2 {
            width: 110px;
            height: 70px;
            bottom: 110px;
        }

        .tree-layer.layer3 {
            width: 80px;
            height: 60px;
            bottom: 150px;
        }

        .tree-trunk {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 32px;
            height: 60px;
            background: linear-gradient(180deg, #8e5a2d, #4e2e12);
            border-radius: 6px;
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.7);
        }

        .firework {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #fff;
            animation: explode 2.5s infinite;
            opacity: 0;
        }

        .firework.f1 {
            top: 20%;
            left: 20%;
            animation-delay: 0s;
        }

        .firework.f2 {
            top: 25%;
            right: 18%;
            animation-delay: 0.7s;
        }

        .firework.f3 {
            top: 10%;
            left: 50%;
            animation-delay: 1.4s;
        }

        @keyframes explode {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            20% {
                opacity: 1;
            }
            50% {
                transform: scale(15);
                opacity: 0.9;
            }
            100% {
                transform: scale(18);
                opacity: 0;
            }
        }

        .final-message {
            font-size: 1.6rem;
            font-weight: bold;
            text-align: center;
            text-shadow: 0 0 18px rgba(255, 255, 255, 0.8);
            margin-bottom: 8px;
        }

        .final-tip {
            font-size: 0.95rem;
            opacity: 0.9;
            text-align: center;
        }

        @media (max-width: 600px) {
            .quiz-wrapper {
                padding: 10px;
            }

            .tree {
                transform: scale(0.8);
            }

            .final-message {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
<div id="top-bar">
    <div class="game-title">Five-Level Challenge</div>
    <div id="current-level-label">Level 1: High Roller Poker</div>
</div>

<div id="levels-container">
    <!-- LEVEL 1 -->
    <section id="level1" class="level-screen">
        <div id="msg-toast"></div>

        <div id="game-table">
            <div class="pot-container">
                <div id="pot-amount" class="pot-label">$0</div>
                <div id="round-status" class="round-info">Waiting...</div>
            </div>

            <div id="bot1" class="player">
                <div class="info-box">
                    <div class="turn-marker">!</div>
                    <div class="p-name">Lucy</div>
                    <div class="p-chips">$<span id="bot1-chips">2000</span></div>
                    <div id="bot1-status" class="p-status"></div>
                </div>
                <div class="hand" id="bot1-hand"></div>
            </div>

            <div id="bot2" class="player">
                <div class="info-box">
                    <div class="turn-marker">!</div>
                    <div class="p-name">Eric</div>
                    <div class="p-chips">$<span id="bot2-chips">2000</span></div>
                    <div id="bot2-status" class="p-status"></div>
                </div>
                <div class="hand" id="bot2-hand"></div>
            </div>

            <div id="bot3" class="player">
                <div class="info-box">
                    <div class="turn-marker">!</div>
                    <div class="p-name">Frank</div>
                    <div class="p-chips">$<span id="bot3-chips">2000</span></div>
                    <div id="bot3-status" class="p-status"></div>
                </div>
                <div class="hand" id="bot3-hand"></div>
            </div>

            <div id="bot4" class="player">
                <div class="info-box">
                    <div class="turn-marker">!</div>
                    <div class="p-name">Geogle</div>
                    <div class="p-chips">$<span id="bot4-chips">2000</span></div>
                    <div id="bot4-status" class="p-status"></div>
                </div>
                <div class="hand" id="bot4-hand"></div>
            </div>

            <div id="player" class="player">
                <div class="hand" id="player-hand"></div>
                <div class="info-box" style="margin-top:10px;">
                    <div class="turn-marker">!</div>
                    <div class="p-name">YOU</div>
                    <div class="p-chips">$<span id="player-chips">2000</span></div>
                    <div id="player-status" class="p-status"></div>
                </div>
            </div>
        </div>

        <div id="controls">
            <button id="btn-next-round" class="btn-show" onclick="game.onNextRoundClick()">
                Start Next Round
                <span class="sub-txt">New Deal</span>
            </button>

            <button id="btn-fold" class="btn-fold" onclick="game.humanAction('fold')">
                Fold
                <span class="sub-txt">Give Up</span>
            </button>
            <button id="btn-check" class="btn-check" onclick="game.humanAction('call')">
                Check
                <span class="sub-txt" id="lbl-check">Free</span>
            </button>
            <button id="btn-raise" class="btn-raise" onclick="game.humanAction('raise')">
                Raise
                <span class="sub-txt" id="lbl-raise">$20</span>
            </button>
            <button id="btn-showhand" class="btn-show" onclick="game.humanAction('showhand')">
                All In
                <span class="sub-txt">Max</span>
            </button>
        </div>
    </section>

    <!-- LEVEL 2 -->
    <section id="level2" class="level-screen">
        <div id="snake-title">Level 2: Neon Snake Arena</div>
        <div id="snake-info">
            Control the green snake with the arrow keys. Other snakes slither on their own.<br>
            Reach a length of <span class="value" id="snakeTarget">0</span> (2Ã— your initial length) to unlock Level 3.
        </div>
        <canvas id="snakeCanvas" width="640" height="400"></canvas>
        <div id="snake-hud">
            <div>Current length: <span class="value" id="snakeLength">0</span></div>
            <div>Lives: <span class="value">infinite â€“ just restart</span></div>
        </div>
        <button id="snakeRestartBtn" class="btn-show">Restart Level</button>
        <div id="snake-message"></div>
    </section>

    <!-- LEVEL 3 (REDESIGNED) -->
    <section id="level3" class="level-screen">
        <div id="pvz-header">
            <h2>Level 3: Plants vs. Zombies Lane Defense</h2>
            <p>Build glowing plants on the lawn to stop the zombie waves. Tractors (lawn mowers) protect each lane once.</p>
            <p>Defeat all zombies to unlock the Science Quiz in Level 4.</p>
        </div>
        <div id="pvz-hud">
            <div>Sun: <span class="value" id="pvz-sun">0</span></div>
            <div>Zombie progress: <span class="value" id="pvz-wave">0 / 0</span></div>
        </div>

        <div id="pvz-board">
            <div id="pvz-grid-wrapper">
                <div id="pvz-grid"></div>
            </div>
            <div id="pvz-side-panel">
                <div id="pvz-message">
                    Click on a grass tile to plant a Peashooter (cost: 50 sun). Plants shoot down the lane towards the zombies.
                </div>
                <button id="pvz-start-btn" class="btn-show">Restart Level</button>
                <div id="pvz-help">
                    Tip: Try to place at least two or three plants in each lane. Tractors automatically clear a lane once when a
                    zombie reaches them, but after that, that lane is unprotected.
                </div>
            </div>
        </div>
    </section>

    <!-- LEVEL 4 -->
    <section id="level4" class="level-screen">
        <div class="quiz-wrapper">
            <h2>Level 4: Physics, Mathematics &amp; Chemistry Quiz</h2>
            <p>There are 60 questions: 20 physics, 20 mathematics, and 20 chemistry. You need at least
                <strong>80% correct</strong> to unlock Level 5.</p>
            <form id="quiz4-form"></form>
            <button id="quiz4-submit" class="quiz-submit-btn">Submit Level 4 Answers</button>
            <div id="quiz4-result" class="quiz-result"></div>
        </div>
    </section>

    <!-- LEVEL 5 -->
    <section id="level5" class="level-screen">
        <div class="quiz-wrapper">
            <h2>Level 5: Daily Life Common Sense Quiz</h2>
            <p>Answer all 20 questions correctly to pass the final level.</p>
            <form id="quiz5-form"></form>
            <button id="quiz5-submit" class="quiz-submit-btn">Submit Level 5 Answers</button>
            <div id="quiz5-result" class="quiz-result"></div>
        </div>
    </section>

    <!-- FINAL SCENE -->
    <section id="ending" class="level-screen">
        <div class="final-scene">
            <div class="firework f1"></div>
            <div class="firework f2"></div>
            <div class="firework f3"></div>

            <div class="tree">
                <div class="tree-star">â˜…</div>
                <div class="tree-layer layer3"></div>
                <div class="tree-layer layer2"></div>
                <div class="tree-layer layer1"></div>
                <div class="tree-trunk"></div>
            </div>

            <div class="final-message">Congratulations, you have passed all levels</div>
            <div class="final-tip">To play again from Level 1, please refresh this webpage.</div>
        </div>
    </section>
</div>

<script>
    // GLOBAL LEVEL STATE
    let currentLevel = 1;
    let maxLevelUnlocked = 1;

    function updateLevelLabel() {
        const label = document.getElementById('current-level-label');
        if (!label) return;
        let text = '';
        switch (currentLevel) {
            case 1: text = 'Level 1: High Roller Poker'; break;
            case 2: text = 'Level 2: Neon Snake Arena'; break;
            case 3: text = 'Level 3: Plants vs. Zombies Defense'; break;
            case 4: text = 'Level 4: Science Quiz'; break;
            case 5: text = 'Level 5: Daily Life Quiz'; break;
            case 6: text = 'All Levels Cleared'; break;
            default: text = '';
        }
        label.textContent = text;
    }

    function unlockLevel(level) {
        if (level > maxLevelUnlocked) {
            maxLevelUnlocked = level;
        }
    }

    function switchToLevel(level) {
        if (typeof level === 'number' && level > maxLevelUnlocked) {
            return;
        }
        currentLevel = level;

        const screens = document.querySelectorAll('.level-screen');
        screens.forEach(s => s.style.display = 'none');

        const screen = document.getElementById('level' + level);
        if (screen) {
            if (level === 1 || level === 2 || level === 3) {
                screen.style.display = 'flex';
            } else {
                screen.style.display = 'block';
            }
        }

        if (typeof snakeGame !== 'undefined' && snakeGame && typeof snakeGame.stop === 'function') {
            snakeGame.stop();
        }
        if (typeof pvzGame !== 'undefined' && pvzGame && typeof pvzGame.stop === 'function') {
            pvzGame.stop();
        }

        if (level === 2 && snakeGame) {
            snakeGame.reset();
            snakeGame.start();
        } else if (level === 3 && pvzGame) {
            pvzGame.reset();
            pvzGame.start();
        }

        updateLevelLabel();
    }

    function showEndingScene() {
        currentLevel = 6;
        const screens = document.querySelectorAll('.level-screen');
        screens.forEach(s => s.style.display = 'none');
        const ending = document.getElementById('ending');
        if (ending) {
            ending.style.display = 'flex';
        }
        if (typeof snakeGame !== 'undefined' && snakeGame) snakeGame.stop();
        if (typeof pvzGame !== 'undefined' && pvzGame) pvzGame.stop();
        updateLevelLabel();
    }

    // LEVEL 1: Poker game (unchanged from previous answer, trimmed comments)

    const SUITS = ['â™¦', 'â™£', 'â™¥', 'â™ '];
    const FULL_RANKS = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
    const RANK_VAL = {
        '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7,
        '8': 8, '9': 9, '10': 10, 'J': 11, 'Q': 12, 'K': 13, 'A': 14
    };
    const INITIAL_CHIPS = 2000;
    const ANTE = 50;

    class Card {
        constructor(suitIdx, rankIdx) {
            this.suitIdx = suitIdx;
            this.rankIdx = rankIdx;
            this.suit = SUITS[suitIdx];
            this.rank = FULL_RANKS[rankIdx];
            this.value = RANK_VAL[this.rank];
            this.color = (this.suit === 'â™¥' || this.suit === 'â™¦') ? 'red' : 'black';
            this.isFaceUp = false;
        }
        getHTML(forceFaceUp = false) {
            const showFront = this.isFaceUp || forceFaceUp;
            if (!showFront) return `<div class="card card-back"></div>`;
            return `
            <div class="card ${this.color}">
                <div class="card-rank">${this.rank}</div>
                <div class="card-suit">${this.suit}</div>
                <div class="card-corner-br">
                    ${this.rank}<br>${this.suit}
                </div>
            </div>`;
        }
    }

    class Deck {
        constructor() {
            this.cards = [];
            this.reset();
        }
        reset() {
            this.cards = [];
            for (let s = 0; s < 4; s++) {
                for (let r = 0; r < 13; r++) {
                    this.cards.push(new Card(s, r));
                }
            }
        }
        fisherYates() {
            for (let i = this.cards.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [this.cards[i], this.cards[j]] = [this.cards[j], this.cards[i]];
            }
        }
        riggedShuffle(numPlayers) {
            this.fisherYates();
            const randType = Math.random();
            let targetCards = [];

            if (randType < 0.5) {
                const suit = Math.floor(Math.random() * 4);
                targetCards = this.cards.filter(c => c.suitIdx === suit).slice(0, 5);
            } else if (randType < 0.85) {
                const rank = Math.floor(Math.random() * 13);
                const four = this.cards.filter(c => c.rankIdx === rank).slice(0, 4);
                const kicker = this.cards.find(c => c.rankIdx !== rank);
                targetCards = [...four, kicker];
            } else {
                const suit = Math.floor(Math.random() * 4);
                const needed = [8, 9, 10, 11, 12];
                targetCards = this.cards.filter(c => c.suitIdx === suit && needed.includes(c.rankIdx));
                if (targetCards.length < 5) {
                    targetCards = this.cards.filter(c => c.suitIdx === suit).slice(0, 5);
                } else {
                    targetCards = targetCards.slice(0, 5);
                }
            }

            if (targetCards.length < 5) {
                this.fisherYates();
                return;
            }

            this.cards = this.cards.filter(c => !targetCards.includes(c));

            const luckyPlayer = Math.floor(Math.random() * numPlayers);
            const newDeck = [];
            let currentTarget = 0;

            for (let i = 0; i < 30; i++) {
                const turnPlayer = i % numPlayers;
                if (turnPlayer === luckyPlayer && currentTarget < 5) {
                    newDeck.push(targetCards[currentTarget]);
                    currentTarget++;
                } else {
                    if (this.cards.length > 0) newDeck.push(this.cards.pop());
                }
            }
            while (this.cards.length) newDeck.push(this.cards.pop());
            this.cards = newDeck.reverse();
        }
        shuffle(numPlayers = 5) {
            if (Math.random() < 0.8) {
                this.riggedShuffle(numPlayers);
            } else {
                this.fisherYates();
            }
        }
        pop() {
            return this.cards.pop();
        }
    }

    class PokerHand {
        static evaluate(cards) {
            if (cards.length < 5) return {strength: 0, kickers: []};
            let v = cards.map(c => c.value).sort((a, b) => b - a);
            let s = cards.map(c => c.suitIdx);
            const isFlush = s.every(suit => suit === s[0]);
            let isStraight = true;
            for (let i = 0; i < 4; i++) {
                if (v[i] - v[i + 1] !== 1) isStraight = false;
            }
            if (!isStraight && v[0] === 14 && v[1] === 5 && v[2] === 4 && v[3] === 3 && v[4] === 2) {
                isStraight = true;
                v = [5, 4, 3, 2, 14];
            }

            const counts = {};
            v.forEach(x => counts[x] = (counts[x] || 0) + 1);
            const keys = Object.keys(counts).map(Number).sort((a, b) => counts[b] - counts[a] || b - a);

            let type = 0;
            if (isFlush && isStraight) type = 9;
            else if (counts[keys[0]] === 4) type = 8;
            else if (counts[keys[0]] === 3 && counts[keys[1]] === 2) type = 7;
            else if (isFlush) type = 6;
            else if (isStraight) type = 5;
            else if (counts[keys[0]] === 3) type = 4;
            else if (counts[keys[0]] === 2 && counts[keys[1]] === 2) type = 3;
            else if (counts[keys[0]] === 2) type = 2;
            else type = 1;

            return {strength: type, kickers: keys, name: this.getHandName(type)};
        }
        static getHandName(type) {
            const names = ["", "High Card", "Pair", "Two Pair", "Trips", "Straight", "Flush", "Full House", "Quads", "Straight Flush"];
            return names[type];
        }
        static highestCard(cards) {
            return cards.reduce((prev, curr) => {
                if (!prev) return curr;
                if (curr.value > prev.value) return curr;
                if (curr.value === prev.value && curr.suitIdx > prev.suitIdx) return curr;
                return prev;
            }, null);
        }
        static compare(cardsA, cardsB) {
            const a = this.evaluate(cardsA);
            const b = this.evaluate(cardsB);
            if (a.strength !== b.strength) return a.strength - b.strength;
            for (let i = 0; i < a.kickers.length; i++) {
                if (a.kickers[i] !== b.kickers[i]) return a.kickers[i] - b.kickers[i];
            }
            const maxA = this.highestCard(cardsA);
            const maxB = this.highestCard(cardsB);
            if (maxA.value !== maxB.value) return maxA.value - maxB.value;
            return maxA.suitIdx - maxB.suitIdx;
        }
        static compareVisible(cardsA, cardsB) {
            const visA = cardsA.filter(c => c.isFaceUp);
            const visB = cardsB.filter(c => c.isFaceUp);
            if (visA.length === 0 || visB.length === 0) return 0;
            const getMax = (arr) => arr.reduce((prev, curr) => {
                if (curr.value > prev.value) return curr;
                if (curr.value === prev.value && curr.suitIdx > prev.suitIdx) return curr;
                return prev;
            });
            const maxA = getMax(visA);
            const maxB = getMax(visB);
            if (maxA.value !== maxB.value) return maxA.value - maxB.value;
            return maxA.suitIdx - maxB.suitIdx;
        }
    }

    class Game {
        constructor() {
            this.players = [
                {id: 0, name: "You", chips: INITIAL_CHIPS, hand: [], folded: false, bet: 0, isBot: false},
                {id: 1, name: "Lucy", chips: INITIAL_CHIPS, hand: [], folded: false, bet: 0, isBot: true},
                {id: 2, name: "Eric", chips: INITIAL_CHIPS, hand: [], folded: false, bet: 0, isBot: true},
                {id: 3, name: "Frank", chips: INITIAL_CHIPS, hand: [], folded: false, bet: 0, isBot: true},
                {id: 4, name: "Geogle", chips: INITIAL_CHIPS, hand: [], folded: false, bet: 0, isBot: true}
            ];
            this.deck = new Deck();
            this.pot = 0;
            this.street = 0;
            this.turnIndex = 0;
            this.currentBet = 0;
            this.turnCount = 0;
            this.gameOver = true;
            this.waitingForNextRound = true;

            this.ui = {
                pot: document.getElementById('pot-amount'),
                status: document.getElementById('round-status'),
                toast: document.getElementById('msg-toast'),
                btns: {
                    next: document.getElementById('btn-next-round'),
                    fold: document.getElementById('btn-fold'),
                    check: document.getElementById('btn-check'),
                    raise: document.getElementById('btn-raise'),
                    show: document.getElementById('btn-showhand')
                },
                lbls: {
                    check: document.getElementById('lbl-check'),
                    raise: document.getElementById('lbl-raise')
                }
            };

            window.game = this;
            window.hkGame = this;

            this.ui.pot.innerText = "$0";
            this.ui.status.innerText = 'Click "Start Next Round" to begin.';
            if (this.ui.btns.next) this.ui.btns.next.disabled = false;
            this.setControls(false);
            this.render();
        }

        msg(text) {
            this.ui.toast.innerText = text;
            this.ui.toast.style.opacity = 1;
            setTimeout(() => this.ui.toast.style.opacity = 0, 2500);
        }

        onNextRoundClick() {
            if (!this.waitingForNextRound || currentLevel !== 1) return;
            this.startNewRound();
        }

        startNewRound() {
            this.waitingForNextRound = false;
            this.gameOver = false;

            const human = this.players[0];
            if (human.chips <= 0) {
                this.gameOver = true;
                this.ui.status.innerText = "Game Over. Refresh to restart.";
                this.setControls(false);
                if (this.ui.btns.next) this.ui.btns.next.disabled = true;
                return;
            }

            this.players.forEach(p => {
                if (p.isBot && p.chips <= ANTE) p.chips = INITIAL_CHIPS;
            });

            this.deck = new Deck();
            this.deck.shuffle(this.players.length);

            this.pot = 0;
            this.currentBet = ANTE;
            this.street = 1;
            this.turnCount = 0;
            this.ui.status.innerText = "Shuffling & Dealing...";

            if (this.ui.btns.next) this.ui.btns.next.disabled = true;

            this.players.forEach(p => {
                p.hand = [];
                p.folded = false;
                p.bet = 0;
                if (p.chips > ANTE) {
                    p.chips -= ANTE;
                    this.pot += ANTE;
                } else {
                    this.pot += p.chips;
                    p.chips = 0;
                }
            });

            this.dealRound(false);
            this.dealRound(true);

            this.render();
            setTimeout(() => this.startStreet(), 1200);
        }

        dealRound(faceUp) {
            this.players.forEach(p => {
                if (!p.folded && p.chips > -999) {
                    const c = this.deck.pop();
                    if (c) {
                        c.isFaceUp = faceUp;
                        p.hand.push(c);
                    }
                }
            });
        }

        determineLeader() {
            let maxPlayer = null;
            let bestHand = null;
            const active = this.players.filter(p => !p.folded);
            if (active.length === 0) return 0;

            active.forEach(p => {
                if (!maxPlayer) {
                    maxPlayer = p;
                    bestHand = p.hand;
                    return;
                }
                if (PokerHand.compareVisible(p.hand, bestHand) > 0) {
                    maxPlayer = p;
                    bestHand = p.hand;
                }
            });
            return this.players.findIndex(p => p.id === maxPlayer.id);
        }

        startStreet() {
            this.turnCount = 0;
            this.currentBet = 0;
            this.players.forEach(p => p.bet = 0);

            this.turnIndex = this.determineLeader();
            const leader = this.players[this.turnIndex];

            this.ui.status.innerText = `Street ${this.street} / 4 - ${leader.name} bets first`;
            this.render();
            this.nextTurn();
        }

        nextTurn() {
            if (this.isStreetComplete()) {
                setTimeout(() => this.advanceStreet(), 500);
                return;
            }

            const p = this.players[this.turnIndex];

            if (p.folded || (p.chips === 0 && p.bet < this.currentBet)) {
                this.rotateTurn();
                this.nextTurn();
                return;
            }

            this.render();

            if (p.isBot) {
                this.setControls(false);
                setTimeout(() => this.botLogic(p), 800 + Math.random() * 500);
            } else {
                if (p.chips === 0) {
                    this.rotateTurn();
                    this.nextTurn();
                } else {
                    this.setControls(true);
                }
            }
        }

        rotateTurn() {
            this.turnIndex = (this.turnIndex + 1) % this.players.length;
            this.turnCount++;
            if (this.turnCount > 30) {
                this.advanceStreet();
            }
        }

        isStreetComplete() {
            const active = this.players.filter(p => !p.folded);
            if (active.length === 1) return true;
            const allMatched = active.every(p => p.bet >= this.currentBet || p.chips === 0);
            return (allMatched && this.turnCount >= active.length);
        }

        humanAction(action) {
            if (currentLevel !== 1) return;
            const p = this.players[0];
            this.processAction(p, action);
        }

        botLogic(bot) {
            let action = 'call';
            const cost = this.currentBet - bot.bet;
            const handVal = PokerHand.evaluate(bot.hand);
            const myStrength = handVal.strength;
            const bluff = Math.random() < 0.1;

            if (cost === 0) {
                if (myStrength >= 2 || bluff) action = 'raise';
                else action = 'call';
            } else {
                if (myStrength >= 6) action = 'raise';
                else if (myStrength >= 2) action = 'call';
                else if (cost < bot.chips * 0.1) action = 'call';
                else if (bluff) action = 'raise';
                else action = 'fold';
            }

            if (action === 'raise' && bot.chips <= cost + 20) action = 'showhand';
            if (action === 'fold' && cost === 0) action = 'call';

            this.processAction(bot, action);
        }

        processAction(p, action) {
            const cost = this.currentBet - p.bet;
            const statusEl = document.getElementById(p.isBot ? `bot${p.id}-status` : 'player-status');
            let txt = "";

            if (action === 'fold') {
                p.folded = true;
                txt = "FOLD";
                if (p.id === 0) this.setControls(false);
            } else if (action === 'call') {
                if (cost <= 0) {
                    txt = "CHECK";
                } else if (p.chips <= cost) {
                    p.bet += p.chips;
                    this.pot += p.chips;
                    p.chips = 0;
                    txt = "ALL IN";
                } else {
                    p.chips -= cost;
                    this.pot += cost;
                    p.bet += cost;
                    txt = "CALL";
                }
            } else if (action === 'raise') {
                const raiseAmt = cost + (this.street * 50);
                if (p.chips >= raiseAmt) {
                    p.chips -= raiseAmt;
                    this.pot += raiseAmt;
                    p.bet += raiseAmt;
                    this.currentBet = p.bet;
                    txt = "RAISE";
                } else {
                    p.bet += p.chips;
                    this.pot += p.chips;
                    p.chips = 0;
                    if (p.bet > this.currentBet) this.currentBet = p.bet;
                    txt = "ALL IN";
                }
            } else if (action === 'showhand') {
                p.bet += p.chips;
                this.pot += p.chips;
                p.chips = 0;
                if (p.bet > this.currentBet) this.currentBet = p.bet;
                txt = "SHOWHAND!";
            }

            if (statusEl) statusEl.innerText = txt;

            this.rotateTurn();
            this.nextTurn();
        }

        advanceStreet() {
            const active = this.players.filter(p => !p.folded);

            if (active.length === 1) {
                this.endGame(active[0]);
                return;
            }

            if (this.street < 4) {
                this.street++;
                this.dealRound(true);
                this.turnCount = 0;
                this.render();
                setTimeout(() => this.startStreet(), 1000);
            } else {
                this.showdown();
            }
        }

        showdown() {
            this.msg("SHOWDOWN!");
            this.players.forEach(p => {
                if (!p.folded && p.hand[0]) {
                    p.hand[0].isFaceUp = true;
                }
            });
            this.render();

            const active = this.players.filter(p => !p.folded);
            let winner = active[0];

            for (let i = 1; i < active.length; i++) {
                const diff = PokerHand.compare(active[i].hand, winner.hand);
                if (diff > 0) {
                    winner = active[i];
                }
            }

            const winHand = PokerHand.evaluate(winner.hand);
            this.msg(`${winner.name} wins with ${winHand.name}!`);

            setTimeout(() => this.endGame(winner), 3500);
        }

        endGame(winner) {
            const wonAmount = this.pot;
            winner.chips += this.pot;
            this.pot = 0;
            this.gameOver = true;
            this.setControls(false);
            this.render();

            this.ui.status.innerText = `${winner.name} wins $${wonAmount}. Click "Start Next Round" to continue.`;
            this.waitingForNextRound = true;
            if (this.ui.btns.next) this.ui.btns.next.disabled = false;

            const humanChips = this.players[0].chips;
            if (humanChips >= 3000 && maxLevelUnlocked < 2) {
                unlockLevel(2);
                this.msg("You reached $3000! Level 2 unlocked.");
                setTimeout(() => {
                    alert("You reached $3000! Level 2 (Snake) is now unlocked.");
                    switchToLevel(2);
                }, 800);
            }
        }

        setControls(enabled) {
            const p = this.players[0];
            const cost = this.currentBet - p.bet;
            const btns = this.ui.btns;

            btns.fold.disabled = !enabled;
            btns.check.disabled = !enabled;
            btns.raise.disabled = !enabled;
            btns.show.disabled = !enabled;

            if (enabled) {
                this.ui.lbls.check.innerText = cost === 0 ? "Free" : `$${cost}`;
                this.ui.lbls.raise.innerText = `$${cost + (this.street * 50)}`;

                if (cost > 0) {
                    btns.check.innerHTML = `Call<span class="sub-txt">$${cost}</span>`;
                } else {
                    btns.check.innerHTML = `Check<span class="sub-txt">Free</span>`;
                }

                if (p.chips < cost + 20) {
                    btns.raise.disabled = true;
                }
                if (p.chips <= cost) {
                    btns.check.innerHTML = `All In<span class="sub-txt">$${p.chips}</span>`;
                    btns.raise.disabled = true;
                }
            }
        }

        render() {
            this.ui.pot.innerText = `$${this.pot}`;
            this.players.forEach(p => {
                const id = p.isBot ? `bot${p.id}` : 'player';
                const el = document.getElementById(id);
                const chipsEl = document.getElementById(`${id}-chips`);
                if (chipsEl) chipsEl.innerText = p.chips;
                const handDiv = document.getElementById(`${id}-hand`);
                const forceFaceUp = (p.id === 0 || this.gameOver);
                handDiv.innerHTML = p.hand.map(c => c.getHTML(forceFaceUp)).join('');

                if (this.players[this.turnIndex] && this.players[this.turnIndex].id === p.id && !this.gameOver) {
                    el.classList.add('active-turn');
                } else {
                    el.classList.remove('active-turn');
                }

                if (p.folded) el.classList.add('folded');
                else el.classList.remove('folded');
            });
        }
    }

    let snakeGame;
    let pvzGame;

    // LEVEL 2: Snake

    function createSnakeGame() {
        const canvas = document.getElementById('snakeCanvas');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        const gridSize = 20;
        const cols = Math.floor(canvas.width / gridSize);
        const rows = Math.floor(canvas.height / gridSize);
        const initialLength = 5;
        const targetLength = initialLength * 100;
        const lengthSpan = document.getElementById('snakeLength');
        const targetSpan = document.getElementById('snakeTarget');
        const msgEl = document.getElementById('snake-message');

        if (targetSpan) targetSpan.textContent = String(targetLength);

        snakeGame = {
            ctx,
            canvas,
            gridSize,
            cols,
            rows,
            initialLength,
            targetLength,
            snakes: [],
            food: [],
            running: false,
            timer: null,
            tickMs: 100,
            tickCount: 0,
            playerIndex: 0,

            reset() {
                this.stop();
                this.snakes = [];
                this.food = [];
                this.tickCount = 0;

                const centerX = Math.floor(this.cols / 4);
                const centerY = Math.floor(this.rows / 2);
                const playerBody = [];
                for (let i = 0; i < this.initialLength; i++) {
                    playerBody.push({x: centerX - i, y: centerY});
                }
                this.snakes.push({
                    body: playerBody,
                    dir: {x: 1, y: 0},
                    nextDir: {x: 1, y: 0},
                    color: '#2ecc71',
                    headColor: '#ffffff',
                    isPlayer: true,
                    alive: true
                });

                const aiColors = ['#e74c3c', '#3498db'];
                for (let s = 0; s < 2; s++) {
                    const startX = Math.floor(this.cols * 0.75);
                    const startY = 5 + s * 7;
                    const body = [];
                    for (let i = 0; i < this.initialLength; i++) {
                        body.push({x: startX + i, y: startY});
                    }
                    this.snakes.push({
                        body,
                        dir: {x: -1, y: 0},
                        nextDir: {x: -1, y: 0},
                        color: aiColors[s],
                        headColor: '#f1c40f',
                        isPlayer: false,
                        alive: true
                    });
                }

                for (let i = 0; i < 5; i++) this.spawnFood();

                if (lengthSpan) lengthSpan.textContent = String(this.snakes[0].body.length);
                if (msgEl) msgEl.textContent = 'Use the arrow keys to move. Avoid running into walls or other snakes!';
                this.draw();
            },

            start() {
                if (this.running) return;
                this.running = true;
                this.timer = setInterval(() => this.tick(), this.tickMs);
            },

            stop() {
                this.running = false;
                if (this.timer) {
                    clearInterval(this.timer);
                    this.timer = null;
                }
            },

            spawnFood() {
                let attempts = 0;
                while (attempts < 200) {
                    attempts++;
                    const pos = {
                        x: Math.floor(Math.random() * this.cols),
                        y: Math.floor(Math.random() * this.rows)
                    };
                    let conflict = false;
                    for (const snake of this.snakes) {
                        for (const seg of snake.body) {
                            if (seg.x === pos.x && seg.y === pos.y) {
                                conflict = true;
                                break;
                            }
                        }
                        if (conflict) break;
                    }
                    if (conflict) continue;
                    if (this.food.some(f => f.x === pos.x && f.y === pos.y)) continue;
                    this.food.push(pos);
                    break;
                }
            },

            handlePlayerDirection(dx, dy) {
                const s = this.snakes[this.playerIndex];
                if (!s || !s.alive) return;
                if (dx === -s.dir.x && dy === -s.dir.y) return;
                s.nextDir = {x: dx, y: dy};
            },

            tick() {
                if (!this.running) return;
                this.tickCount++;

                for (const s of this.snakes) {
                    if (!s.alive) continue;
                    s.dir = {x: s.nextDir.x, y: s.nextDir.y};
                }

                const newHeads = new Array(this.snakes.length);
                const allBodyPositions = new Set();

                this.snakes.forEach((s, idx) => {
                    if (!s.alive) return;
                    for (const seg of s.body) {
                        allBodyPositions.add(seg.x + ',' + seg.y);
                    }
                });

                for (let i = 0; i < this.snakes.length; i++) {
                    const s = this.snakes[i];
                    if (!s.alive) continue;
                    const head = s.body[0];
                    const newHead = {x: head.x + s.dir.x, y: head.y + s.dir.y};

                    if (newHead.x < 0 || newHead.x >= this.cols || newHead.y < 0 || newHead.y >= this.rows) {
                        s.alive = false;
                        continue;
                    }
                    newHeads[i] = newHead;
                }

                const headMap = {};
                for (let i = 0; i < newHeads.length; i++) {
                    const nh = newHeads[i];
                    if (!nh) continue;
                    const key = nh.x + ',' + nh.y;
                    if (headMap[key] !== undefined) {
                        this.snakes[i].alive = false;
                        this.snakes[headMap[key]].alive = false;
                    } else {
                        headMap[key] = i;
                    }
                }

                for (let i = 0; i < newHeads.length; i++) {
                    const nh = newHeads[i];
                    if (!nh) continue;
                    const s = this.snakes[i];
                    if (!s.alive) continue;
                    const key = nh.x + ',' + nh.y;
                    if (allBodyPositions.has(key)) {
                        s.alive = false;
                    }
                }

                for (let i = 0; i < this.snakes.length; i++) {
                    const s = this.snakes[i];
                    const nh = newHeads[i];
                    if (!s.alive || !nh) continue;

                    s.body.unshift(nh);
                    let ate = false;
                    for (let f = 0; f < this.food.length; f++) {
                        const food = this.food[f];
                        if (food.x === nh.x && food.y === nh.y) {
                            this.food.splice(f, 1);
                            ate = true;
                            this.spawnFood();
                            break;
                        }
                    }
                    if (!ate) {
                        s.body.pop();
                    }
                }

                const player = this.snakes[this.playerIndex];
                if (!player || !player.alive) {
                    this.stop();
                    if (msgEl) msgEl.textContent = 'You crashed! Click "Restart Level" to try again.';
                    return;
                }

                if (lengthSpan) lengthSpan.textContent = String(player.body.length);

                if (this.food.length < 3 && this.tickCount % 5 === 0) {
                    this.spawnFood();
                }

                this.draw();
                this.checkLevelComplete();
            },

            draw() {
                const w = this.canvas.width;
                const h = this.canvas.height;
                this.ctx.fillStyle = '#000611';
                this.ctx.fillRect(0, 0, w, h);

                this.ctx.strokeStyle = '#111a2a';
                this.ctx.lineWidth = 1;
                for (let x = 0; x <= this.cols; x++) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(x * this.gridSize + 0.5, 0);
                    this.ctx.lineTo(x * this.gridSize + 0.5, h);
                    this.ctx.stroke();
                }
                for (let y = 0; y <= this.rows; y++) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(0, y * this.gridSize + 0.5);
                    this.ctx.lineTo(w, y * this.gridSize + 0.5);
                    this.ctx.stroke();
                }

                for (const food of this.food) {
                    this.ctx.fillStyle = '#f1c40f';
                    this.ctx.beginPath();
                    this.ctx.arc(
                        (food.x + 0.5) * this.gridSize,
                        (food.y + 0.5) * this.gridSize,
                        this.gridSize * 0.35,
                        0,
                        Math.PI * 2
                    );
                    this.ctx.fill();
                }

                for (const s of this.snakes) {
                    if (!s.alive) continue;
                    for (let i = s.body.length - 1; i >= 0; i--) {
                        const seg = s.body[i];
                        const x = seg.x * this.gridSize;
                        const y = seg.y * this.gridSize;
                        this.ctx.fillStyle = i === 0 ? (s.headColor || s.color) : s.color;
                        this.ctx.fillRect(
                            x + 2,
                            y + 2,
                            this.gridSize - 4,
                            this.gridSize - 4
                        );
                    }
                }
            },

            checkLevelComplete() {
                const player = this.snakes[this.playerIndex];
                if (!player) return;
                if (player.body.length >= this.targetLength/50) {
                    this.stop();
                    unlockLevel(3);
                    alert('Amazing! You reached 2Ã— your starting length. Level 3 unlocked.');
                    switchToLevel(3);
                }
            }
        };

        snakeGame.reset();

        const restartBtn = document.getElementById('snakeRestartBtn');
        if (restartBtn) {
            restartBtn.addEventListener('click', () => {
                snakeGame.reset();
                snakeGame.start();
            });
        }

        window.addEventListener('keydown', function (e) {
            if (currentLevel !== 2 || !snakeGame || !snakeGame.running) return;
            let dir = null;
            switch (e.key) {
                case 'ArrowUp': dir = {x: 0, y: -1}; break;
                case 'ArrowDown': dir = {x: 0, y: 1}; break;
                case 'ArrowLeft': dir = {x: -1, y: 0}; break;
                case 'ArrowRight': dir = {x: 1, y: 0}; break;
                default: return;
            }
            e.preventDefault();
            snakeGame.handlePlayerDirection(dir.x, dir.y);
        });
    }

    // LEVEL 3: PvZ

    function createPvZGame() {
        const gridEl = document.getElementById('pvz-grid');
        if (!gridEl) return;
        const ROWS = 5;
        const COLS = 9;

        const sunEl = document.getElementById('pvz-sun');
        const waveEl = document.getElementById('pvz-wave');
        const msgEl = document.getElementById('pvz-message');

        pvzGame = {
            ROWS,
            COLS,
            gridEl,
            plants: [],
            zombies: [],
            mowers: [],
            sun: 100,
            sunPerTick: 0.6,
            maxSun: 999,
            plantCost: 50,
            spawnIntervalTicks: 40,
            totalZombies: 18,
            spawnedZombies: 0,
            deadZombies: 0,
            tickCount: 0,
            running: false,
            timer: null,

            initGrid() {
                this.gridEl.innerHTML = '';
                this.mowers = [];
                for (let r = 0; r < this.ROWS; r++) {
                    for (let c = 0; c < this.COLS; c++) {
                        const cell = document.createElement('div');
                        cell.className = 'pvz-cell';
                        cell.dataset.row = String(r);
                        cell.dataset.col = String(c);
                        if (c === 0) {
                            cell.classList.add('home-lane');
                            const mower = document.createElement('div');
                            mower.className = 'pvz-mower';
                            cell.appendChild(mower);
                            this.mowers[r] = {row: r, active: true, element: mower};
                        } else {
                            cell.addEventListener('click', () => this.handleCellClick(r, c));
                        }
                        this.gridEl.appendChild(cell);
                    }
                }
            },

            reset() {
                this.stop();
                this.plants = [];
                this.zombies = [];
                this.sun = 100;
                this.spawnedZombies = 0;
                this.deadZombies = 0;
                this.tickCount = 0;
                this.initGrid();
                if (msgEl) msgEl.textContent = 'Click on grass tiles to plant Peashooters (cost: 50 sun). Build enough to stop the wave!';
                this.updateDom();
            },

            start() {
                if (this.running) return;
                this.running = true;
                this.timer = setInterval(() => this.tick(), 120);
            },

            stop() {
                this.running = false;
                if (this.timer) {
                    clearInterval(this.timer);
                    this.timer = null;
                }
            },

            handleCellClick(row, col) {
                if (!this.running) return;
                if (col === 0) return;
                if (this.sun < this.plantCost) {
                    if (msgEl) msgEl.textContent = 'Not enough sun to plant. Wait a bit longer!';
                    return;
                }
                const existing = this.plants.find(p => p.row === row && p.col === col);
                if (existing) {
                    if (msgEl) msgEl.textContent = 'There is already a plant here.';
                    return;
                }
                this.placePlant(row, col);
            },

            placePlant(row, col) {
                this.sun -= this.plantCost;
                this.plants.push({row, col, hp: 5});
                this.updateDom();
            },

            spawnZombie() {
                const row = Math.floor(Math.random() * this.ROWS);
                this.zombies.push({
                    row,
                    pos: this.COLS - 0.5,
                    hp: 8,
                    speed: 0.04 + Math.random() * 0.03
                });
                this.spawnedZombies++;
            },

            tick() {
                if (!this.running) return;
                this.tickCount++;

                this.sun = Math.min(this.maxSun, this.sun + this.sunPerTick);

                if (this.spawnedZombies < this.totalZombies && this.tickCount % this.spawnIntervalTicks === 0) {
                    this.spawnZombie();
                }

                for (let i = 0; i < this.zombies.length; i++) {
                    const z = this.zombies[i];
                    z.pos -= z.speed;
                }

                for (let i = 0; i < this.zombies.length; i++) {
                    const z = this.zombies[i];
                    const colIndex = Math.round(z.pos);
                    const plantIndex = this.plants.findIndex(p => p.row === z.row && p.col === colIndex);
                    if (plantIndex !== -1) {
                        const plant = this.plants[plantIndex];
                        plant.hp -= 0.1;
                        z.pos += z.speed * 0.5;
                        if (plant.hp <= 0) {
                            this.plants.splice(plantIndex, 1);
                        }
                    }
                }

                for (let i = this.zombies.length - 1; i >= 0; i--) {
                    const z = this.zombies[i];
                    if (z.pos <= 0) {
                        const mower = this.mowers[z.row];
                        if (mower && mower.active) {
                            mower.active = false;
                            mower.element.classList.add('used');
                            for (let j = this.zombies.length - 1; j >= 0; j--) {
                                if (this.zombies[j].row === z.row) {
                                    this.zombies.splice(j, 1);
                                    this.deadZombies++;
                                }
                            }
                        } else {
                            this.gameOver();
                            return;
                        }
                    }
                }

                if (this.tickCount % 10 === 0) {
                    this.damageZombiesFromPlants();
                }

                for (let i = this.zombies.length - 1; i >= 0; i--) {
                    if (this.zombies[i].hp <= 0) {
                        this.zombies.splice(i, 1);
                        this.deadZombies++;
                    }
                }

                this.updateDom();
                this.checkWinLoss();
            },

            damageZombiesFromPlants() {
                for (let r = 0; r < this.ROWS; r++) {
                    const rowPlants = this.plants.filter(p => p.row === r);
                    if (rowPlants.length === 0) continue;
                    const rowZombies = this.zombies.filter(z => z.row === r);
                    if (rowZombies.length === 0) continue;
                    let shots = rowPlants.length;
                    while (shots > 0 && rowZombies.length > 0) {
                        let front = rowZombies[0];
                        for (const z of rowZombies) {
                            if (z.pos < front.pos) front = z;
                        }
                        front.hp -= 1;
                        shots--;
                    }
                }
            },

            gameOver() {
                this.stop();
                if (msgEl) msgEl.textContent = 'A zombie reached your house! Click "Restart Level" to try again.';
            },

            findCell(row, col) {
                return this.gridEl.querySelector(`.pvz-cell[data-row="${row}"][data-col="${col}"]`);
            },

            updateDom() {
                if (sunEl) sunEl.textContent = String(Math.floor(this.sun));
                if (waveEl) waveEl.textContent = `${this.deadZombies} / ${this.totalZombies}`;

                const cells = this.gridEl.querySelectorAll('.pvz-cell');
                cells.forEach(c => {
                    c.classList.remove('has-plant', 'has-zombie');
                    c.querySelectorAll('.pvz-plant, .pvz-zombie').forEach(el => el.remove());
                });

                for (const p of this.plants) {
                    const cell = this.findCell(p.row, p.col);
                    if (!cell) continue;
                    cell.classList.add('has-plant');
                    const plantEl = document.createElement('div');
                    plantEl.className = 'pvz-plant';
                    cell.appendChild(plantEl);
                }

                for (const z of this.zombies) {
                    const colIndex = Math.round(z.pos);
                    const cell = this.findCell(z.row, colIndex);
                    if (!cell) continue;
                    cell.classList.add('has-zombie');
                    const zombieEl = document.createElement('div');
                    zombieEl.className = 'pvz-zombie';
                    cell.appendChild(zombieEl);
                }
            },

            checkWinLoss() {
                if (this.deadZombies >= this.totalZombies && this.zombies.length === 0) {
                    this.stop();
                    if (msgEl) msgEl.textContent = 'All zombies defeated! Level 4 unlocked.';
                    unlockLevel(4);
                    alert('You have defeated all zombies! Level 4 (Science Quiz) unlocked.');
                    switchToLevel(4);
                }
            }
        };

        pvzGame.reset();

        const startBtn = document.getElementById('pvz-start-btn');
        if (startBtn) {
            startBtn.addEventListener('click', () => {
                pvzGame.reset();
                pvzGame.start();
            });
        }
    }

    // QUIZZES (Levels 4 & 5)

    const quiz4Questions = [
        // Physics (20)
        {
            category: 'Physics',
            question: 'The SI unit of force is:',
            options: ['Joule (J)', 'Watt (W)', 'Newton (N)', 'Pascal (Pa)'],
            answer: 2
        },
        {
            category: 'Physics',
            question: 'The approximate speed of light in vacuum is:',
            options: ['3.0 Ã— 10^8 m/s', '3.0 Ã— 10^6 m/s', '3.0 Ã— 10^4 m/s', '3.0 Ã— 10^2 m/s'],
            answer: 0
        },
        {
            category: 'Physics',
            question: 'Which of the following is NOT a vector quantity?',
            options: ['Velocity', 'Displacement', 'Temperature', 'Force'],
            answer: 2
        },
        {
            category: 'Physics',
            question: 'The acceleration due to gravity near Earthâ€™s surface is about:',
            options: ['1.0 m/sÂ²', '4.9 m/sÂ²', '9.8 m/sÂ²', '98 m/sÂ²'],
            answer: 2
        },
        {
            category: 'Physics',
            question: 'If a distanceâ€“time graph is a straight line through the origin, the motion is:',
            options: ['Non-uniform acceleration', 'Constant speed', 'At rest', 'Simple harmonic motion'],
            answer: 1
        },
        {
            category: 'Physics',
            question: 'The potential energy of an object of mass m at height h in a uniform gravity field g is:',
            options: ['mgh', '1/2 mvÂ²', 'mg/h', 'm/vh'],
            answer: 0
        },
        {
            category: 'Physics',
            question: 'The law of inertia is also called:',
            options: ['Newtonâ€™s first law', 'Newtonâ€™s second law', 'Newtonâ€™s third law', 'Law of gravitation'],
            answer: 0
        },
        {
            category: 'Physics',
            question: 'Momentum is defined as:',
            options: ['Force Ã— time', 'Mass Ã— velocity', 'Mass Ã— acceleration', 'Power Ã— time'],
            answer: 1
        },
        {
            category: 'Physics',
            question: 'Which is an example of a non-contact force?',
            options: ['Frictional force', 'Normal force', 'Gravitational force', 'Tension'],
            answer: 2
        },
        {
            category: 'Physics',
            question: 'In vacuum, which of the following travels fastest?',
            options: ['Red light', 'Gamma rays', 'Radio waves', 'They all travel at the same speed'],
            answer: 3
        },
        {
            category: 'Physics',
            question: 'The SI unit of electric current is:',
            options: ['Volt', 'Ohm', 'Ampere', 'Coulomb'],
            answer: 2
        },
        {
            category: 'Physics',
            question: 'In a series circuit, the current through each resistor is:',
            options: ['Different', 'Zero', 'The same', 'Half the total'],
            answer: 2
        },
        {
            category: 'Physics',
            question: 'A mirror that can produce a real, inverted image of a distant object is:',
            options: ['Plane mirror', 'Convex mirror', 'Concave mirror', 'Any mirror'],
            answer: 2
        },
        {
            category: 'Physics',
            question: 'Sound cannot travel through:',
            options: ['Solids', 'Liquids', 'Gases', 'Vacuum'],
            answer: 3
        },
        {
            category: 'Physics',
            question: 'When ice melts into liquid water, this is:',
            options: ['A nuclear change', 'A chemical change', 'A physical change', 'An irreversible reaction'],
            answer: 2
        },
        {
            category: 'Physics',
            question: 'Which method of heat transfer does NOT require a medium?',
            options: ['Conduction', 'Convection', 'Radiation', 'All require a medium'],
            answer: 2
        },
        {
            category: 'Physics',
            question: 'Pressure is defined as:',
            options: ['Force Ã— Area', 'Force / Area', 'Area / Force', 'Mass Ã— Acceleration'],
            answer: 1
        },
        {
            category: 'Physics',
            question: 'The work done by a constant force is:',
            options: ['Force + displacement', 'Force / displacement', 'Force Ã— displacement (in the direction of force)', 'Mass Ã— displacement'],
            answer: 2
        },
        {
            category: 'Physics',
            question: 'The principle that energy cannot be created or destroyed is:',
            options: ['Conservation of momentum', 'Conservation of energy', 'Conservation of mass', 'Conservation of charge'],
            answer: 1
        },
        {
            category: 'Physics',
            question: 'The temperature scale that starts at absolute zero is:',
            options: ['Celsius', 'Fahrenheit', 'Kelvin', 'Rankine'],
            answer: 2
        },

        // Mathematics (20)
        {
            category: 'Mathematics',
            question: 'Solve for x: 2x + 3 = 11',
            options: ['x = 3', 'x = 4', 'x = 5', 'x = 8'],
            answer: 1
        },
        {
            category: 'Mathematics',
            question: 'The area of a triangle with base b and height h is:',
            options: ['b Ã— h', '1/2 Ã— b Ã— h', '2b Ã— h', 'b + h'],
            answer: 1
        },
        {
            category: 'Mathematics',
            question: 'The slope of a line is defined as:',
            options: ['rise / run', 'run / rise', 'x / y', 'y Ã— x'],
            answer: 0
        },
        {
            category: 'Mathematics',
            question: 'Which of these numbers is prime?',
            options: ['9', '12', '17', '21'],
            answer: 2
        },
        {
            category: 'Mathematics',
            question: 'The value of Ï€ (pi) is approximately:',
            options: ['2.14', '3.14', '3.41', '3.04'],
            answer: 1
        },
        {
            category: 'Mathematics',
            question: '1/2 + 1/3 equals:',
            options: ['2/5', '3/5', '5/6', '1/6'],
            answer: 2
        },
        {
            category: 'Mathematics',
            question: 'The quadratic xÂ² âˆ’ 4x + 4 = 0 has the solution:',
            options: ['x = 4', 'x = âˆ’2', 'x = 2', 'No real solution'],
            answer: 2
        },
        {
            category: 'Mathematics',
            question: '10% of 250 is:',
            options: ['2.5', '25', '50', '250'],
            answer: 1
        },
        {
            category: 'Mathematics',
            question: '5â° (five to the power zero) equals:',
            options: ['0', '1', '5', 'Undefined'],
            answer: 1
        },
        {
            category: 'Mathematics',
            question: 'In a right triangle, the side opposite the right angle is called the:',
            options: ['Adjacent', 'Hypotenuse', 'Base', 'Height'],
            answer: 1
        },
        {
            category: 'Mathematics',
            question: 'The mean (average) of 2, 4, 6, 8 is:',
            options: ['4', '5', '6', '8'],
            answer: 1
        },
        {
            category: 'Mathematics',
            question: 'The perimeter of a rectangle with length 4 and width 6 is:',
            options: ['10', '20', '24', '40'],
            answer: 1
        },
        {
            category: 'Mathematics',
            question: '(x + 3)(x âˆ’ 3) simplifies to:',
            options: ['xÂ² + 9', 'xÂ² âˆ’ 9', 'xÂ² âˆ’ 6x + 9', 'xÂ² + 6x + 9'],
            answer: 1
        },
        {
            category: 'Mathematics',
            question: 'The sum of the interior angles of a triangle is:',
            options: ['90Â°', '120Â°', '180Â°', '360Â°'],
            answer: 2
        },
        {
            category: 'Mathematics',
            question: 'The area of a circle with radius r is:',
            options: ['2Ï€r', 'Ï€rÂ²', 'Ï€d', 'Ï€rÂ³'],
            answer: 1
        },
        {
            category: 'Mathematics',
            question: 'Which statement is true?',
            options: ['Negative Ã— negative = negative', 'Negative Ã— positive = positive', 'Negative Ã— negative = positive', 'Positive Ã— positive = negative'],
            answer: 2
        },
        {
            category: 'Mathematics',
            question: '0.25 written as a fraction in simplest form is:',
            options: ['1/2', '1/4', '1/5', '2/5'],
            answer: 1
        },
        {
            category: 'Mathematics',
            question: '2Â³ Ã— 2Â² equals:',
            options: ['2âµ = 32', '2â¶ = 64', '2â´ = 16', '2Â³ = 8'],
            answer: 0
        },
        {
            category: 'Mathematics',
            question: 'The median of the data set {1, 3, 5, 7, 9} is:',
            options: ['3', '5', '7', '9'],
            answer: 1
        },
        {
            category: 'Mathematics',
            question: 'Which of the following measures the spread or variability of data?',
            options: ['Mean', 'Median', 'Mode', 'Standard deviation'],
            answer: 3
        },

        // Chemistry (20)
        {
            category: 'Chemistry',
            question: 'The smallest unit of an element that retains its identity is:',
            options: ['Molecule', 'Atom', 'Ion', 'Compound'],
            answer: 1
        },
        {
            category: 'Chemistry',
            question: 'Hâ‚‚O is the chemical formula for:',
            options: ['Hydrogen peroxide', 'Water', 'Ozone', 'Salt'],
            answer: 1
        },
        {
            category: 'Chemistry',
            question: 'A solution with pH 7 at 25Â°C is considered:',
            options: ['Acidic', 'Basic (alkaline)', 'Neutral', 'Highly corrosive'],
            answer: 2
        },
        {
            category: 'Chemistry',
            question: 'COâ‚‚ is best described as:',
            options: ['An element', 'A compound', 'A mixture', 'A metal'],
            answer: 1
        },
        {
            category: 'Chemistry',
            question: 'The main gas in Earthâ€™s atmosphere by volume is:',
            options: ['Oxygen', 'Carbon dioxide', 'Nitrogen', 'Argon'],
            answer: 2
        },
        {
            category: 'Chemistry',
            question: 'An ionic bond typically forms between:',
            options: ['Two metals', 'Two nonmetals', 'A metal and a nonmetal', 'Two noble gases'],
            answer: 2
        },
        {
            category: 'Chemistry',
            question: 'A proton carries what electric charge?',
            options: ['Positive', 'Negative', 'Neutral', 'Can be positive or negative'],
            answer: 0
        },
        {
            category: 'Chemistry',
            question: 'Which of the following lists states of matter?',
            options: ['Solid, liquid, gas', 'Liquid, gas, plasma only', 'Solid and liquid only', 'Gas and plasma only'],
            answer: 0
        },
        {
            category: 'Chemistry',
            question: 'Rusting of iron is an example of:',
            options: ['Physical change', 'Chemical change', 'Nuclear reaction', 'State change'],
            answer: 1
        },
        {
            category: 'Chemistry',
            question: 'NaCl is commonly known as:',
            options: ['Baking soda', 'Table sugar', 'Table salt', 'Vinegar'],
            answer: 2
        },
        {
            category: 'Chemistry',
            question: 'The atomic number of an element is equal to the number of:',
            options: ['Protons', 'Neutrons', 'Electrons', 'Molecules'],
            answer: 0
        },
        {
            category: 'Chemistry',
            question: 'The noble gases are located in which group of the periodic table?',
            options: ['Group 1', 'Group 2', 'Group 17', 'Group 18'],
            answer: 3
        },
        {
            category: 'Chemistry',
            question: 'A catalyst in a chemical reaction:',
            options: ['Is consumed by the reaction', 'Slows down the reaction', 'Speeds up the reaction and is not consumed', 'Changes the products formed'],
            answer: 2
        },
        {
            category: 'Chemistry',
            question: 'Distillation is a technique used to separate mixtures based on:',
            options: ['Color differences', 'Boiling point differences', 'Density differences', 'Magnetic properties'],
            answer: 1
        },
        {
            category: 'Chemistry',
            question: 'Avogadroâ€™s number is approximately:',
            options: ['6.02 Ã— 10Â²Â²', '6.02 Ã— 10Â²Â³', '6.02 Ã— 10Â²â´', '6.02 Ã— 10Â²âµ'],
            answer: 1
        },
        {
            category: 'Chemistry',
            question: 'The main acid present in vinegar is:',
            options: ['Hydrochloric acid', 'Sulfuric acid', 'Acetic acid', 'Nitric acid'],
            answer: 2
        },
        {
            category: 'Chemistry',
            question: 'Which subatomic particle orbits around the nucleus?',
            options: ['Proton', 'Neutron', 'Electron', 'Positron'],
            answer: 2
        },
        {
            category: 'Chemistry',
            question: 'Combustion of fuel (like burning wood or gasoline) is typically:',
            options: ['Endothermic', 'Exothermic', 'Neither', 'Nuclear'],
            answer: 1
        },
        {
            category: 'Chemistry',
            question: 'A solution with pH less than 7 is:',
            options: ['Neutral', 'Basic', 'Acidic', 'Always harmless'],
            answer: 2
        },
        {
            category: 'Chemistry',
            question: 'Which of the following is a metal property?',
            options: ['Poor conductor of heat', 'Brittle and dull', 'Good electrical conductor and malleable', 'Always transparent'],
            answer: 2
        }
    ];

    const quiz5Questions = [
        {
            category: 'Daily Life',
            question: 'How long is it recommended to wash your hands with soap and water?',
            options: ['About 5 seconds', 'At least 20 seconds', '1 minute minimum', 'Rinsing with water only is enough'],
            answer: 1
        },
        {
            category: 'Daily Life',
            question: 'Boiling water at sea level has a temperature of approximately:',
            options: ['50Â°C', '75Â°C', '100Â°C', '150Â°C'],
            answer: 2
        },
        {
            category: 'Daily Life',
            question: 'Storing food in a refrigerator mainly helps to:',
            options: ['Change its flavor', 'Make it heavier', 'Slow the growth of bacteria', 'Increase vitamins'],
            answer: 2
        },
        {
            category: 'Daily Life',
            question: 'Dentists usually recommend brushing your teeth:',
            options: ['Once a week', 'Once a day', 'At least twice a day', 'Only when they hurt'],
            answer: 2
        },
        {
            category: 'Daily Life',
            question: 'A red traffic light means:',
            options: ['Go faster', 'Prepare to go', 'Stop and wait', 'Turn right only'],
            answer: 2
        },
        {
            category: 'Daily Life',
            question: 'To save electricity at home, a simple habit is to:',
            options: ['Leave lights on all the time', 'Turn off lights when leaving a room', 'Open the refrigerator door to cool the room', 'Use more heaters in summer'],
            answer: 1
        },
        {
            category: 'Daily Life',
            question: 'A balanced diet should include:',
            options: ['Only meat', 'Only fruits', 'A mix of fruits, vegetables, grains, and protein', 'Only sweets and snacks'],
            answer: 2
        },
        {
            category: 'Daily Life',
            question: 'Airplane mode on a phone mainly:',
            options: ['Increases volume', 'Turns off wireless signals like cellular and Wi-Fi', 'Deletes photos', 'Charges the battery'],
            answer: 1
        },
        {
            category: 'Daily Life',
            question: 'When taking medicine, you should:',
            options: ['Guess the dose', 'Follow the label or doctorâ€™s instructions', 'Take extra for faster effect', 'Share prescription drugs with friends'],
            answer: 1
        },
        {
            category: 'Daily Life',
            question: 'In a building fire, you should generally:',
            options: ['Use the elevator', 'Stay inside and ignore alarms', 'Use the stairs and leave quickly if safe to do so', 'Return to get forgotten items'],
            answer: 2
        },
        {
            category: 'Daily Life',
            question: 'To reduce eye strain when using a computer, it helps to:',
            options: ['Sit very close to the screen', 'Never take breaks', 'Blink often and take short breaks regularly', 'Use the device in complete darkness'],
            answer: 2
        },
        {
            category: 'Daily Life',
            question: 'Most adults are recommended to sleep:',
            options: ['3â€“4 hours per night', '5â€“6 hours per night', '7â€“9 hours per night', 'More than 12 hours every night'],
            answer: 2
        },
        {
            category: 'Daily Life',
            question: 'If you spill water on a smooth floor, you should:',
            options: ['Leave it to dry by itself', 'Cover it with paper only', 'Clean it up to prevent slipping', 'Ignore it'],
            answer: 2
        },
        {
            category: 'Daily Life',
            question: 'Using sunscreen when outdoors mainly helps to:',
            options: ['Cool your body', 'Block all sunlight', 'Protect skin from UV damage', 'Make you invisible'],
            answer: 2
        },
        {
            category: 'Daily Life',
            question: 'Which of the following is usually recyclable in many places?',
            options: ['Clean paper and cardboard', 'Dirty tissues', 'Used cooking oil poured into sink', 'Broken glass scattered on the street'],
            answer: 0
        },
        {
            category: 'Daily Life',
            question: 'Which item should you NOT put in a microwave?',
            options: ['Ceramic plate (microwave safe)', 'Glass bowl (microwave safe)', 'Metal fork', 'Microwave-safe plastic container'],
            answer: 2
        },
        {
            category: 'Daily Life',
            question: 'When walking near traffic at night, it is safer to wear:',
            options: ['Dark clothing only', 'Light or reflective clothing', 'Clothes that match the road color', 'No clothing'],
            answer: 1
        },
        {
            category: 'Daily Life',
            question: 'If someone is seriously injured and you are not sure what to do, an important step is to:',
            options: ['Do nothing at all', 'Immediately search their pockets', 'Call emergency services for help', 'Move them around quickly'],
            answer: 2
        },
        {
            category: 'Daily Life',
            question: 'Which of the following helps prevent the spread of respiratory infections?',
            options: ['Coughing into your hands then touching everything', 'Covering coughs/sneezes and washing hands', 'Sharing drinks with many people', 'Never washing your hands'],
            answer: 1
        },
        {
            category: 'Daily Life',
            question: 'Before plugging in a new electrical appliance, you should:',
            options: ['Ignore the instructions', 'Read basic safety instructions and check the voltage', 'Use it in water first', 'Remove the plugâ€™s protective cover and discard it'],
            answer: 1
        }
    ];

    function buildQuiz(formId, questions, namePrefix) {
        const form = document.getElementById(formId);
        if (!form) return;
        let html = '';
        let currentCategory = '';
        questions.forEach((q, index) => {
            if (q.category && q.category !== currentCategory) {
                currentCategory = q.category;
                html += `<h3>${currentCategory}</h3>`;
            }
            html += `<fieldset class="quiz-question">
                        <legend>${index + 1}. ${q.question}</legend>`;
            q.options.forEach((opt, optIndex) => {
                const id = `${namePrefix}${index}_${optIndex}`;
                html += `<label for="${id}">
                            <input type="radio" id="${id}" name="${namePrefix}${index}" value="${optIndex}">
                            ${String.fromCharCode(65 + optIndex)}. ${opt}
                         </label>`;
            });
            html += `</fieldset>`;
        });
        form.innerHTML = html;
    }

    function evaluateQuiz(formId, questions, namePrefix) {
        const form = document.getElementById(formId);
        if (!form) return 0;
        let correct = 0;
        questions.forEach((q, index) => {
            const chosen = form.querySelector(`input[name="${namePrefix}${index}"]:checked`);
            if (chosen && parseInt(chosen.value, 10) === q.answer) {
                correct++;
            }
        });
        return correct;
    }

    function initQuizzes() {
        buildQuiz('quiz4-form', quiz4Questions, 'q4_');
        buildQuiz('quiz5-form', quiz5Questions, 'q5_');

        const submit4 = document.getElementById('quiz4-submit');
        const result4 = document.getElementById('quiz4-result');
        if (submit4 && result4) {
            submit4.addEventListener('click', () => {
                const correct = evaluateQuiz('quiz4-form', quiz4Questions, 'q4_');
                const total = quiz4Questions.length;
                const percent = Math.round(correct / total * 100);
                result4.textContent = `You answered ${correct} out of ${total} correctly (${percent}%).`;
                if (percent >= 80) {
                    unlockLevel(5);
                    alert('Great job! Level 5 (Daily Life Quiz) unlocked.');
                    switchToLevel(5);
                } else {
                    result4.textContent += ' You need at least 80% to unlock the next level. Try again!';
                }
            });
        }

        const submit5 = document.getElementById('quiz5-submit');
        const result5 = document.getElementById('quiz5-result');
        if (submit5 && result5) {
            submit5.addEventListener('click', () => {
                const correct = evaluateQuiz('quiz5-form', quiz5Questions, 'q5_');
                const total = quiz5Questions.length;
                const percent = Math.round(correct / total * 100);
                result5.textContent = `You answered ${correct} out of ${total} correctly (${percent}%).`;
                if (correct === total) {
                    result5.textContent += ' Perfect score!';
                    alert('Perfect! You cleared every level.');
                    showEndingScene();
                } else {
                    result5.textContent += ' You must answer all questions correctly to pass this final level.';
                }
            });
        }
    }

    // --- INITIALIZATION ---
    window.addEventListener('load', function () {
        switchToLevel(1);
        new Game();
        createSnakeGame();
        createPvZGame();
        initQuizzes();
    });
</script>
</body>
</html>